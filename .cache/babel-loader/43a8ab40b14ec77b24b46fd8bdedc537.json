{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectSpread from \"@babel/runtime/helpers/objectSpread\";\nimport pathToRegexp, { compile } from 'path-to-regexp';\nimport * as NavigationActions from '../NavigationActions';\nimport invariant from '../utils/invariant';\n\nvar queryString = require('query-string');\n\nexport var getParamsFromPath = function getParamsFromPath(inputParams, pathMatch, pathMatchKeys) {\n  var params = pathMatch.slice(1).reduce(function (paramsOut, matchResult, i) {\n    var key = pathMatchKeys[i];\n\n    if (!key || key.asterisk) {\n      return paramsOut;\n    }\n\n    var paramName = key.name;\n    var decodedMatchResult;\n\n    if (matchResult) {\n      try {\n        decodedMatchResult = decodeURIComponent(matchResult);\n      } catch (e) {}\n    }\n\n    paramsOut[paramName] = decodedMatchResult || matchResult;\n    return paramsOut;\n  }, _objectSpread({}, inputParams));\n  return params;\n};\n\nvar getRestOfPath = function getRestOfPath(pathMatch, pathMatchKeys) {\n  var rest = pathMatch[pathMatchKeys.findIndex(function (k) {\n    return k.asterisk;\n  }) + 1];\n  return rest;\n};\n\nexport var urlToPathAndParams = function urlToPathAndParams(url, uriPrefix) {\n  var searchMatch = url.match(/^(.*)\\?(.*)$/);\n  var params = searchMatch ? queryString.parse(searchMatch[2]) : {};\n  var urlWithoutSearch = searchMatch ? searchMatch[1] : url;\n  var delimiter = uriPrefix || '://';\n  var path = urlWithoutSearch.split(delimiter)[1];\n\n  if (path === undefined) {\n    path = urlWithoutSearch;\n  }\n\n  if (path === '/') {\n    path = '';\n  }\n\n  if (path[path.length - 1] === '/') {\n    path = path.slice(0, -1);\n  }\n\n  return {\n    path: path,\n    params: params\n  };\n};\nexport var createPathParser = function createPathParser(childRouters, routeConfigs, _ref) {\n  var _ref$paths = _ref.paths,\n      pathConfigs = _ref$paths === void 0 ? {} : _ref$paths,\n      disableRouteNamePaths = _ref.disableRouteNamePaths;\n  var pathsByRouteNames = {};\n  var paths = [];\n  Object.keys(childRouters).forEach(function (routeName) {\n    var pathPattern;\n\n    if (pathConfigs[routeName] !== undefined) {\n      pathPattern = pathConfigs[routeName];\n    } else {\n      pathPattern = routeConfigs[routeName].path;\n    }\n\n    if (pathPattern === undefined) {\n      pathPattern = disableRouteNamePaths ? null : routeName;\n    }\n\n    invariant(pathPattern === null || typeof pathPattern === 'string', \"Route path for \" + routeName + \" must be specified as a string, or null.\");\n    var isPathMatchable = pathPattern !== null;\n    var exactReKeys = [];\n    var exactRe = isPathMatchable ? pathToRegexp(pathPattern, exactReKeys) : null;\n    var extendedPathReKeys = [];\n    var isWildcard = pathPattern === '' || !isPathMatchable;\n    var extendedPathRe = pathToRegexp(isWildcard ? '*' : pathPattern + \"/*\", extendedPathReKeys);\n    pathsByRouteNames[routeName] = {\n      exactRe: exactRe,\n      exactReKeys: exactReKeys,\n      extendedPathRe: extendedPathRe,\n      extendedPathReKeys: extendedPathReKeys,\n      isWildcard: isWildcard,\n      toPath: pathPattern === null ? function () {\n        return '';\n      } : compile(pathPattern)\n    };\n  });\n  paths = Object.entries(pathsByRouteNames);\n\n  var getActionForPathAndParams = function getActionForPathAndParams() {\n    var pathToResolve = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var inputParams = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    for (var _iterator = paths, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[typeof Symbol === \"function\" ? Symbol.iterator : \"@@iterator\"]();;) {\n      var _ref4;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref4 = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref4 = _i.value;\n      }\n\n      var _ref8 = _ref4;\n\n      var _ref3 = _slicedToArray(_ref8, 2);\n\n      var _routeName2 = _ref3[0];\n      var _path2 = _ref3[1];\n      var exactRe = _path2.exactRe,\n          exactReKeys = _path2.exactReKeys,\n          extendedPathRe = _path2.extendedPathRe,\n          extendedPathReKeys = _path2.extendedPathReKeys;\n      var childRouter = childRouters[_routeName2];\n      var exactMatch = exactRe && exactRe.exec(pathToResolve);\n\n      if (exactMatch && exactMatch.length) {\n        var extendedMatch = extendedPathRe && extendedPathRe.exec(pathToResolve);\n        var childAction = null;\n\n        if (extendedMatch && childRouter) {\n          var restOfPath = getRestOfPath(extendedMatch, extendedPathReKeys);\n          childAction = childRouter.getActionForPathAndParams(restOfPath, inputParams);\n        }\n\n        return NavigationActions.navigate({\n          routeName: _routeName2,\n          params: getParamsFromPath(inputParams, exactMatch, exactReKeys),\n          action: childAction\n        });\n      }\n    }\n\n    for (var _iterator2 = paths, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[typeof Symbol === \"function\" ? Symbol.iterator : \"@@iterator\"]();;) {\n      var _ref7;\n\n      if (_isArray2) {\n        if (_i2 >= _iterator2.length) break;\n        _ref7 = _iterator2[_i2++];\n      } else {\n        _i2 = _iterator2.next();\n        if (_i2.done) break;\n        _ref7 = _i2.value;\n      }\n\n      var _ref9 = _ref7;\n\n      var _ref6 = _slicedToArray(_ref9, 2);\n\n      var _routeName3 = _ref6[0];\n      var _path3 = _ref6[1];\n      var _extendedPathRe = _path3.extendedPathRe,\n          _extendedPathReKeys = _path3.extendedPathReKeys;\n      var _childRouter = childRouters[_routeName3];\n\n      var _extendedMatch = _extendedPathRe && _extendedPathRe.exec(pathToResolve);\n\n      if (_extendedMatch && _extendedMatch.length) {\n        var _restOfPath = getRestOfPath(_extendedMatch, _extendedPathReKeys);\n\n        var _childAction = null;\n\n        if (_childRouter) {\n          _childAction = _childRouter.getActionForPathAndParams(_restOfPath, inputParams);\n        }\n\n        if (!_childAction) {\n          continue;\n        }\n\n        return NavigationActions.navigate({\n          routeName: _routeName3,\n          params: getParamsFromPath(inputParams, _extendedMatch, _extendedPathReKeys),\n          action: _childAction\n        });\n      }\n    }\n\n    return null;\n  };\n\n  var getPathAndParamsForRoute = function getPathAndParamsForRoute(route) {\n    var routeName = route.routeName,\n        params = route.params;\n    var childRouter = childRouters[routeName];\n    var _pathsByRouteNames$ro = pathsByRouteNames[routeName],\n        toPath = _pathsByRouteNames$ro.toPath,\n        exactReKeys = _pathsByRouteNames$ro.exactReKeys;\n    var subPath = toPath(params);\n    var nonPathParams = {};\n\n    if (params) {\n      Object.keys(params).filter(function (paramName) {\n        return !exactReKeys.find(function (k) {\n          return k.name === paramName;\n        });\n      }).forEach(function (paramName) {\n        nonPathParams[paramName] = params[paramName];\n      });\n    }\n\n    if (childRouter) {\n      var child = childRouter.getPathAndParamsForState(route);\n      return {\n        path: subPath ? subPath + \"/\" + child.path : child.path,\n        params: child.params ? _objectSpread({}, nonPathParams, child.params) : nonPathParams\n      };\n    }\n\n    return {\n      path: subPath,\n      params: nonPathParams\n    };\n  };\n\n  return {\n    getActionForPathAndParams: getActionForPathAndParams,\n    getPathAndParamsForRoute: getPathAndParamsForRoute\n  };\n};","map":null,"metadata":{},"sourceType":"module"}