{"ast":null,"code":"'use strict';\n\nconst u = require('universalify').fromCallback;\n\nconst path = require('path');\n\nconst fs = require('graceful-fs');\n\nconst _mkdirs = require('../mkdirs');\n\nconst mkdirs = _mkdirs.mkdirs;\nconst mkdirsSync = _mkdirs.mkdirsSync;\n\nconst _symlinkPaths = require('./symlink-paths');\n\nconst symlinkPaths = _symlinkPaths.symlinkPaths;\nconst symlinkPathsSync = _symlinkPaths.symlinkPathsSync;\n\nconst _symlinkType = require('./symlink-type');\n\nconst symlinkType = _symlinkType.symlinkType;\nconst symlinkTypeSync = _symlinkType.symlinkTypeSync;\n\nconst pathExists = require('../path-exists').pathExists;\n\nfunction createSymlink(srcpath, dstpath, type, callback) {\n  callback = typeof type === 'function' ? type : callback;\n  type = typeof type === 'function' ? false : type;\n  pathExists(dstpath, (err, destinationExists) => {\n    if (err) return callback(err);\n    if (destinationExists) return callback(null);\n    symlinkPaths(srcpath, dstpath, (err, relative) => {\n      if (err) return callback(err);\n      srcpath = relative.toDst;\n      symlinkType(relative.toCwd, type, (err, type) => {\n        if (err) return callback(err);\n        const dir = path.dirname(dstpath);\n        pathExists(dir, (err, dirExists) => {\n          if (err) return callback(err);\n          if (dirExists) return fs.symlink(srcpath, dstpath, type, callback);\n          mkdirs(dir, err => {\n            if (err) return callback(err);\n            fs.symlink(srcpath, dstpath, type, callback);\n          });\n        });\n      });\n    });\n  });\n}\n\nfunction createSymlinkSync(srcpath, dstpath, type, callback) {\n  callback = typeof type === 'function' ? type : callback;\n  type = typeof type === 'function' ? false : type;\n  const destinationExists = fs.existsSync(dstpath);\n  if (destinationExists) return undefined;\n  const relative = symlinkPathsSync(srcpath, dstpath);\n  srcpath = relative.toDst;\n  type = symlinkTypeSync(relative.toCwd, type);\n  const dir = path.dirname(dstpath);\n  const exists = fs.existsSync(dir);\n  if (exists) return fs.symlinkSync(srcpath, dstpath, type);\n  mkdirsSync(dir);\n  return fs.symlinkSync(srcpath, dstpath, type);\n}\n\nmodule.exports = {\n  createSymlink: u(createSymlink),\n  createSymlinkSync\n};","map":null,"metadata":{},"sourceType":"script"}